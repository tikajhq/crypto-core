<style>


    .record > .data {
        -moz-transition: all .2s ease-in;
        -o-transition: all .2s ease-in;
        -webkit-transition: all .2s ease-in;
        transition: all .2s ease-in;
    }

    .record:nth-child(even) > .data {
        background: #c4e3f3
    }

    .record:nth-child(odd) > .data {
        background: #f2dede
    }

    .record .data:hover {
        background: rgb(229, 229, 229);
        color: #000000;
    }

    pre {
        font-family: monospace;
        font-size: 13px;
        font-style: normal;
        font-variant: normal;
        font-weight: 400;
        line-height: 18.5714px;
        padding: 5px;
    }

    .healthstat {
        padding: 5px;
        margin: 5px;
    }

    .healthstat.health-0 {
        background-color: #EC644B;
    }

    .healthstat.health-100 {
        background-color: #2ECC71;
    }

</style>

<div id="health"></div>
<br/>
<div>
    <form action="" id="form_content">
        <input id="type" value="subscribe" placeholder="event"/>
        <input id="data" value='{"event": "incoming_tx", "currency": "doge"}'
               placeholder='{"event": "incoming_tx", "currency": "doge"}' style="width: 50%;"/>
        <button id="send">Send</button>
    </form>
</div>
<div id="container">

</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    var address = 'ws://api.cc.cal.tik.co:4101';
    if (location.hostname === "localhost" || location.hostname === "127.0.0.1")
        address = 'ws://localhost:4101';

    var ws = new WebSocket(address);

    var health = {};

    function createHealthStatus() {
        var html = "";
        Object.keys(health).forEach((notation) => {
            var healthstat = health[notation];
            html += "<span class='healthstat health-" + healthstat.status + "'>" + healthstat.currency.toUpperCase() + " : " + healthstat.history[healthstat.history.length - 1] + "</span>"
        });

        $('#health').html(html);
    }

    function send(type, params) {
        return ws.send(JSON.stringify({type: type, params: params}))
    }

    // event emmited when connected
    ws.onopen = function () {
        log('Connected to server...');
        // sending a send event to websocket server
        send("subscribe", {"event": "health_updates", currencies: "*"})
    };

    function log(data) {

        if (data.event === "health_updates") {
            if (data.data) {
                health[data.currency] = data.data;
                createHealthStatus();
            }
            // console.log(data);
        } else
            $("<div class='record'><div class='data'><pre>" + JSON.stringify(data, null, 2) + "</pre></div></div>").hide().prependTo($container).slideToggle();
    }

    var $container = $("#container");
    // event emmited when receiving message
    ws.onmessage = function (ev) {
        log(JSON.parse(ev.data))
    };

    $(document).on('click', '#send', function (e) {
        // this will prevent form and reload page on submit.
        e.preventDefault();
        send($("#type").val().trim(), JSON.parse($("#data").val().trim()));
    });
</script>